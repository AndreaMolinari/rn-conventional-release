name: Request new version

on:
  push:
    branches:
      - "feat-*"
      - "fix-*"
      - "!feat-update-projects-version"
      - "!develop"
      - "!main"

  workflow_dispatch:
    inputs:
      type_release:
        description: Chose release type
        type: choice
        default: "alpha"
        options:
          - "aplha"
          - "beta"
          - "rc"
          - "new release"
      first_release:
        description: Is a First Release
        type: boolean
      pre_release_github:
        description: Is a pre-release for GitHub
        type: boolean
        default: false
      draft:
        description: Is a Draft Release
        type: boolean
        default: false
      release_as:
        description: Release As
        type: string
permissions: write-all

jobs:
  release:
    runs-on: ubuntu-latest
    if: github.event_name == 'workflow_dispatch'
    steps:
      - uses: ./../rn-conventional-release
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          first-release: ${{ inputs.first_release }}
          pre-release-name: ${{ inputs.type_release }}
          pre-release-github: ${{ inputs.pre_release_github }}
          draft: ${{ inputs.draft }}
          release-as: ${{ inputs.release_as }}

  check-release:
    runs-on: ubuntu-latest
    if: github.event_name == 'push'
    outputs:
      release-it: ${{ steps.need-release.outputs.releaseIt }}
    steps:
      - id: need-release
        name: Check release request
        run: |
          echo "releaseIt=false" >> $GITHUB_OUTPUT
          RELEASE_PREFIX=":chore :bookmark:"

          if [[ "${{ github.event.head_commit.message }}" == "$RELEASE_PREFIX"* ]]; then
            echo "releaseIt=true" >> $GITHUB_OUTPUT
          fi

  release-it:
    if: needs.check-release.outputs.release-it == 'true'
    needs: check-release
    runs-on: ubuntu-latest

    steps:
      - uses: actions/Checkout@v4
      - uses: actions/setup-node@v3
      - uses: ./../rn-conventional-release
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          pre-release-name: "alpha-${{ github.head_ref }}"

          draft: true

  message:
    if: needs.check-release.outputs.release-it == 'false'
    needs: check-release
    runs-on: ubuntu-latest

    steps:
      - run: echo "::warning ::Notthing to release ðŸ˜œ"
